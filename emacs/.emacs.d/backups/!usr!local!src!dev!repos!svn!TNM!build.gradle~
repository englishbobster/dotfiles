apply plugin: 'base'
apply plugin: 'arbortext'
apply from: "${rootDir}/gradle/version.gradle"

buildscript {
    repositories {
        maven {
            url "${artifactory_contextUrl}/repo"
        }
    }
    dependencies {
        classpath 'se.transmode.gradle:gradle-arbortext:0.1.2'
    }
}

task wrapper(type: Wrapper) {
    gradleVersion = '2.2'
}

if(hasProperty('upgrade')) {
	def toVersion = "${version.major}.${version.minor}"
	def fromVersion = "${versionPrevious.major}.${versionPrevious.minor}"

	ant.replace(file: 'ServerAdmin/TNM_ServerAdmin.xml', token: fromVersion, value: toVersion)
	ant.replace(file: 'Installation/TNM_InstWindows.xml', token: fromVersion, value: toVersion)
	ant.replace(file: 'Installation/TNM_InstLinux.xml', token: fromVersion, value: toVersion)
	ant.replace(file: 'Installation/TNM_RepLinux.xml', token: fromVersion, value: toVersion)
	ant.replace(file: 'Installation/TNM_RepWin.xml', token: fromVersion, value: toVersion)
	ant.replace(file: 'NorthboundInterfaces/TNM_IF.xml', token: fromVersion, value: toVersion)
	ant.replace(file: 'NorthboundInterfaces/TNM_IF_MODEL.xml', token: fromVersion, value: toVersion)
}

task docServerAdmin(type: Arbortext) {
    url = "http://arbortext.transmode.se:8081/e3/servlet/e3"
    contextDir = file('ServerAdmin')
    inputFile = file('ServerAdmin/TNM_ServerAdmin.xml')
}

task docInstLinux(type: Arbortext) {
    url = "http://arbortext.transmode.se:8081/e3/servlet/e3"
    contextDir = file('Installation')
    inputFile = file('Installation/TNM_InstLinux.xml')
}

task docInstWin(type: Arbortext) {
    url = "http://arbortext.transmode.se:8081/e3/servlet/e3"
    contextDir = file('Installation')
    inputFile = file('Installation/TNM_InstWindows.xml')
}

task docRepLinux(type: Arbortext) {
    url = "http://arbortext.transmode.se:8081/e3/servlet/e3"
    contextDir = file('Installation')
    inputFile = file('Installation/TNM_RepLinux.xml')
}

task docRepWin(type: Arbortext) {
    url = "http://arbortext.transmode.se:8081/e3/servlet/e3"
    contextDir = file('Installation')
    inputFile = file('Installation/TNM_RepWin.xml')
}

task docIf(type: Arbortext) {
    url = "http://arbortext.transmode.se:8081/e3/servlet/e3"
    contextDir = file('NorthboundInterfaces')
    inputFile = file('NorthboundInterfaces/TNM_IF.xml')
}

task docIfWs(type: Arbortext) {
    url = "http://arbortext.transmode.se:8081/e3/servlet/e3"
    contextDir = file('NorthboundInterfaces')
    inputFile = file('NorthboundInterfaces/TNM_IF_WS.xml')
}

task docIfModel(type: Arbortext) {
    url = "http://arbortext.transmode.se:8081/e3/servlet/e3"
    contextDir = file('NorthboundInterfaces')
    inputFile = file('NorthboundInterfaces/TNM_IF_MODEL.xml')
}

task docs {
    dependsOn docServerAdmin
    dependsOn docRepLinux
    dependsOn docRepWin
    dependsOn docIf
    dependsOn docIfModel
}

task distZip(dependsOn: docs, type: Zip) {
    from "${buildDir}/docs"
    baseName 'tnm-docs'
}
