FROM centos:7
LABEL maintainer="stuart.osborne@infinera.com"

#dependencies first
RUN yum install -y epel-release && \
yum update -y && \
yum install -y wget && \
yum install -y wxBase.x86_64 && \
yum install -y gcc && \
yum install -y gcc-c++ && \
yum install -y glibc-devel && \
yum install -y make && \
yum install -y ncurses-devel && \
yum install -y openssl-devel && \
yum install -y autoconf && \
yum install -y java-1.8.0-openjdk-devel && \
yum install -y git

# Erlang
RUN wget https://packages.erlang-solutions.com/erlang-solutions-1.0-1.noarch.rpm
RUN rpm -Uvh erlang-solutions-1.0-1.noarch.rpm
RUN yum update -y && \
yum install -y esl-erlang && \
rm -rf erlang-solutions-1.0-1.noarch.rpm

#Elixir
RUN git clone https://github.com/elixir-lang/elixir.git

#Need to set LC_ALL=en_US.UTF-8 in the locale
ENV LANG=en_US.utf-8

#build elixir
RUN cd elixir && make clean test

#set elixir path
ENV PATH /elixir/bin:$PATH

#Clean up after us
RUN yum clean all

#Put the executable in the container
COPY  "alarm_app" "/alarm_app"

#And then run it in the container
ENTRYPOINT ["./alarm_app"]
