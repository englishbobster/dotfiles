defmodule CowboyHandler do

  def init(_type, req,  _opts) do
    {:upgrade, :protocol, :cowboy_rest}
  end

  def to_html(request, state), do: {message(), request, state}

  def to_json(request, state), do: {Poison.encode!(%{iterator: 3, wtf: %{drink: "fuck yeah"}}), request, state}


#  def handle(request, state) do
#    {:ok, reply} = :cowboy_req.reply(200, headers(), message(), request)
#    {:ok, reply, state}
#  end

  defp message do
    "<h1>Hello Worlds of Norn!</h1>"
  end

  defp headers do
    [{"content-type", "text/html"}]
  end

  def content_types_provided(request, state) do
    {[{"text/html", :to_html},
    {"application/json", :to_json}], request, state}
  end

  def terminate(_reason, _request, _state), do: :ok

end
